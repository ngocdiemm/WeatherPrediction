<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Meteorological Data</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    
</head>
<body>
    <h1>My Meteorological Data</h1>
    

    <div class="chart-container" id="locationContainer">
        <p><strong>Longitude:</strong> <span></span></p>
        <p><strong>Latitude:</strong> <span></span></p>
    </div>
    <div class="chart-container" id="temperatureChart"></div>
    <div class="chart-container" id="windChart"></div>
    <div class="chart-container" id="visibilityChart"></div>
    <div class="chart-container" id="cloudChart"></div>
    <div class="chart-container" id="humidityChart"></div>
    <div class="chart-container" id="pressureChart"></div>
    <div class="chart-container" id="rainChart"></div>
    
    <script>
        $(document).ready(function () {
            // Function to update weather data on the page
            function updateWeatherData(data) {
                // Iterate through each feature and update the HTML
                $(".chart-container p strong").each(function () {
                    var featureName = $(this).text().replace(":", "").trim();
                    var featureValue = data[featureName.toLowerCase()];

                    // Update the text content of the corresponding <span> element
                    $(this).parent().find("span").text(": " + featureValue);
                });
            }
            //const apiUrl = "{}";
            //$.post(apiUrl, function (data)) {

                //print(data)

                // Dummy data for testing
                var dummyData = {
                    timestamps: [1, 2, 3, 4, 5],
                    temperatures: [20, 22, 25, 18, 23],
                    wind: [10, 12, 15, 8, 13],
                    visibility: [1000, 800, 1200, 900, 1100],
                    cloud: [50, 60, 40, 70, 55],
                    humidity: [75, 80, 70, 85, 78],
                    pressure: [1015, 1010, 1020, 1005, 1018],
                    rain: [0, 0, 5, 2, 0],
                    longitude: 10.99,
                    latitude: 44.34,
                    utc_time: [1661870592, 1661874592, 1661878592, 1661882592, 1661886592]
                };

                // Update weather data on the page
                updateWeatherData(dummyData);

                // Extract data for each feature
                var timestamps = dummyData.timestamps;
                var temperatures = dummyData.temperatures;
                var wind = dummyData.wind;
                var visibility = dummyData.visibility;
                var cloud = dummyData.cloud;
                var humidity = dummyData.humidity;
                var pressure = dummyData.pressure;
                var rain = dummyData.rain;
                var latitude = dummyData.latitude;
                var longitude = dummyData.longitude;
                var utc_time = dummyData.utc_time;

                // Create a line chart for temperature, wind, visibility, and cloud
                createLineChart('temperatureChart', 'Meteorological Data', timestamps, temperatures, wind, visibility, cloud, 'Temperature (K)', 'Wind Speed (m/s)', 'Visibility (m)', 'Cloud (%)');

                // Create a bar chart for humidity, pressure, and rain
                createBarChart('humidityChart', 'Meteorological Data', timestamps, humidity, pressure, rain, 'Humidity (%)', 'Pressure (hPa)', 'Rain (mm)');

                // Create stacked area chart for cloud and humidity
                createStackedAreaChart('cloudChart', 'Cloud and Humidity Area Chart', timestamps, cloud, humidity, 'Cloud (%)', 'Humidity (%)');

                // Update location container with longitude, latitude, and UTC time
                updateLocationContainer(longitude, latitude, utc_time);
            //}
        });

        // Function to create a Highcharts line chart
        function createLineChart(containerId, title, categories, temperatures, wind, visibility, cloud, tempUnit, windUnit, visUnit, cloudUnit) {
            Highcharts.chart(containerId, {
                chart: {
                    type: 'line',
                    width: $(window).width() * 2 / 3 // Set the chart width to two-thirds of the screen width
                },
                title: {
                    text: title + ' Line Chart'
                },
                xAxis: {
                    categories: categories.map(function(timestamp) {
                        return new Date(timestamp * 1000).toLocaleString();
                    })
                },
                yAxis: [{
                    title: {
                        text: 'Temperature (K)'
                    }
                }, {
                    title: {
                        text: 'Wind Speed (m/s)'
                    },
                    opposite: true
                }, {
                    title: {
                        text: 'Visibility (m)'
                    },
                    opposite: true
                }, {
                    title: {
                        text: 'Cloud (%)'
                    },
                    opposite: true
                }],
                series: [{
                    name: 'Temperature',
                    data: temperatures,
                    yAxis: 0,
                    tooltip: {
                        valueSuffix: ' ' + tempUnit
                    }
                }, {
                    name: 'Wind',
                    data: wind,
                    yAxis: 1,
                    tooltip: {
                        valueSuffix: ' ' + windUnit
                    }
                }, {
                    name: 'Visibility',
                    data: visibility,
                    yAxis: 2,
                    tooltip: {
                        valueSuffix: ' ' + visUnit
                    }
                }, {
                    name: 'Cloud',
                    data: cloud,
                    yAxis: 3,
                    tooltip: {
                        valueSuffix: ' ' + cloudUnit
                    }
                }]
            });
        }

        // Function to create a Highcharts combined bar chart
        function createBarChart(containerId, title, categories, humidity, pressure, rain, humUnit, pressUnit, rainUnit) {
            Highcharts.chart(containerId, {
                chart: {
                    type: 'bar',
                    width: $(window).width() * 2 / 3 // Set the chart width to two-thirds of the screen width
                },
                title: {
                    text: title + ' Bar Chart'
                },
                xAxis: {
                    categories: categories.map(function(timestamp) {
                        return new Date(timestamp * 1000).toLocaleString();
                    })
                },
                yAxis: [{
                    title: {
                        text: 'Humidity (%)'
                    }
                }, {
                    title: {
                        text: 'Pressure (hPa)'
                    },
                    opposite: true
                }, {
                    title: {
                        text: 'Rain (mm)'
                    },
                    opposite: true
                }],
                series: [{
                    name: 'Humidity',
                    data: humidity,
                    yAxis: 0,
                    tooltip: {
                        valueSuffix: ' ' + humUnit
                    }
                }, {
                    name: 'Pressure',
                    data: pressure,
                    yAxis: 1,
                    tooltip: {
                        valueSuffix: ' ' + pressUnit
                    }
                }, {
                    name: 'Rain',
                    data: rain,
                    yAxis: 2,
                    tooltip: {
                        valueSuffix: ' ' + rainUnit
                    }
                }]
            });
        }

         // Function to create a Highcharts stacked area chart
        function createStackedAreaChart(containerId, title, categories, humidity, cloud, humUnit, cloudUnit) {
            Highcharts.chart(containerId, {
                chart: {
                    type: 'area',
                    width: $(window).width() * 2 / 3 // Set the chart width to two-thirds of the screen width
                },
                title: {
                    text: title
                },
                xAxis: {
                    categories: categories.map(function (timestamp) {
                        return new Date(timestamp * 1000).toLocaleString();
                    })
                },
                yAxis: {
                    title: {
                        text: 'Values'
                    }
                },
                plotOptions: {
                    area: {
                        stacking: 'normal'
                    }
                },
                series: [{
                    name: 'Humidity',
                    data: humidity,
                    tooltip: {
                        valueSuffix: ' ' + humUnit
                    }
                }, {
                    name: 'Cloud',
                    data: cloud,
                    tooltip: {
                        valueSuffix: ' ' + cloudUnit
                    }
                }]
            });
        }


        // Function to update location container with longitude, latitude, and UTC time
        function updateLocationContainer(longitude, latitude) {
            $("#locationContainer p:nth-child(1) span").text(": " + longitude.toFixed(2)); // Display longitude
            $("#locationContainer p:nth-child(2) span").text(": " + latitude.toFixed(2));  // Display latitude
    
        }

        // Update chart position when the window is resized
        $(window).resize(function () {
            createLineChart('temperatureChart', 'Meteorological Data', timestamps, temperatures, wind, visibility, cloud, 'Temperature (K)', 'Wind Speed (m/s)', 'Visibility (m)', 'Cloud (%)');
            createBarChart('humidityChart', 'Meteorological Data', timestamps, humidity, pressure, rain, 'Humidity (%)', 'Pressure (hPa)', 'Rain (mm)');
            createStackedAreaChart('cloudChart', 'Cloud and Humidity Area Chart', timestamps, cloud, humidity, 'Cloud (%)', 'Humidity (%)');
        });
    </script>
</body>
</html>
